%=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=
%             _             _
%            | |           | |
%  _ __ ___  | |__    ___  | | ___   ___   _ __       ___   ___   _ __ ___
% | '_ ` _ \ | '_ \  / _ \ | |/ __| / _ \ | '_ \     / __| / _ \ | '_ ` _ \
% | | | | | || | | || (_) || |\__ \| (_) || | | | _ | (__ | (_) || | | | | |
% |_| |_| |_||_| |_| \___/ |_||___/ \___/ |_| |_|(_) \___| \___/ |_| |_| |_|
%
% Author: Mark H. Olson
% Website: https://mholson.com
% Github: https://github.com/mholson
%
% Created: 2021-05-25
%=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=

%=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
% DOCUMENT CLASS & PACKAGES
%=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=

\documentclass[a4paper, 11pt]{article}

\usepackage{mhocolorthemenord}
\usepackage{mhomath}
\usepackage{mhotikz}
\usepackage{mhoworksheet}
%=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
% BEGIN DOCUMENT
%=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=

\begin{document}

\maketitle % Print the title section

% =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
% SAGE SILENT
%=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=

\begin{sagesilent}
# Generate and set a random seed.
t=ZZ.random_element(999999)
#set_random_seed(t)
set_random_seed(43)

# Create some question in the range(1,k) 1-(k-1))
#qnum=[i for i in range(1,5)]
qnum=[i for i in range(4)]

# Parameters of the function in the form a f( b x + c ) + d
a=[(-1)^(ZZ.random_element(1,3))*(ZZ.random_element(1,5)) for i in range(len(qnum))]
b=[(-1)^(ZZ.random_element(1,3))*(ZZ.random_element(1,4)) for i in range(len(qnum))]
m30angles = [(-1)^(ZZ.random_element(1,3))*30*i for i in range(7)]
m45angles = [(-1)^(ZZ.random_element(1,3))*45*i for i in range(5)]
allAngles = list(set(m30angles + m45angles))
c = [allAngles[i] for i in range(len(qnum))]
d=[(-1)^(ZZ.random_element(1,3))*(ZZ.random_element(1,4)) for i in range(len(qnum))]

# Features of Interest
phaseshift=[-c[i]/b[i] for i in range(len(qnum))]
amplitude=[abs(a[i]) for i in range(len(qnum))]
period=[360/abs(b[i]) for i in range(len(qnum))]
fmaxg=[int(d[i]+abs(a[i])+1) for i in range(len(qnum))]
fming=[int(d[i]-abs(a[i])-1) for i in range(len(qnum))]
fmax=[d[i]+abs(a[i]) for i in range(len(qnum))]
fmin=[d[i]-abs(a[i]) for i in range(len(qnum))]
maxmin=[]

# Generate the the function for both display and evaluating
functionq=[latex(a[i]*sin(b[i]*(x)+c[i])+d[i]) for i in range(len(qnum))]
function=[a[i]*sin(b[i]*(x*pi/180)+c[i]*(pi/180))+d[i] for i in range(len(qnum))]
sa=[(fmax[i]+fmin[i])/2 for i in range(len(qnum))]

# Determine if the function is reflected about the sinusoidal axis using sin(-x)=-sin(x) identity
for k in range(len(qnum)):
    if a[k]>0:
        if b[k]>0:
            maxmin.append("not reflected")
        else:
            maxmin.append("reflected")
    else:
        if b[k]>0:
            maxmin.append("reflected")
        else:
            maxmin.append("not reflected")

# Generate x-values for each (poi) point of interest where x = PhaseShift + Period/4
xpoi = []
npoi = 5 # number of points of interest
for j in range(len(qnum)):
    xpoi.append([phaseshift[j] + (period[j]*i/4) for i in range(npoi)])

opairs = []
for j in range(len(qnum)):
    xcoords = [xpoi[j][i] for i in range(npoi)]
    ycoords = [function[j].subs(x==(xcoords[i])) for i in range(npoi)]
    xypairs = list(zip(xcoords,ycoords))
    opairs.append(xypairs)

myPoints = []
for j in range(len(qnum)):
        myPoints.append([opairs[j][i] for i in range(npoi)])

plotPoints = [f"{myPoints[i]}, rgbcolor=(0.7490196078431373, 0.3803921568627451, 0.41568627450980394), size=50" for i in range(len(qnum))]

# Plot the empty Cartesian planes
tickList = [30*i for i in range(-6,13)]
plotQuestions=[f"{function[i]},(x,{tickList[0]},{tickList[-1]}),ymin={fming[i]},ymax={fmaxg[i]},axes_labels=['$x  \degree $', '$ y$ '],thickness=0,ticks=[{tickList}, 1],tick_formatter='latex',figsize=[7,2.0],fontsize=7,gridlines='True',frame='True'" for i in range(len(qnum))]

# Plot the Sinusoidal axis
plotSA=[f"{sa[i]},(x,{tickList[0]},{tickList[-1]}),rgbcolor=(0.7058823529411765, 0.5568627450980392, 0.6784313725490196),thickness=3" for i in range(len(qnum))]

# Plot the function
plotFunctions = [f"{function[i]},(x,{tickList[0]},{tickList[-1]}),ymin={fming[i]},ymax={fmaxg[i]},axes_labels=['$x  \degree $', '$y$'],thickness=3,rgbcolor = (0.3686274509803922, 0.5058823529411764, 0.674509803921568),ticks=[{tickList}, 1],tick_formatter='latex',figsize=[7,2.0],fontsize=7,gridlines='True',frame='True'" for i in range(len(qnum))]

outputq = ""
outputa = ""

# Questions Page 1

for i in range(len(qnum)):
    outputq += rf"{qnum[i]}. \( y = {functionq[i]} \) \hfill \newline "
    outputq += rf"\sageplot{{ plot({plotQuestions[i]},zorder=0)}} \hfill \newline "
    outputa += rf"{qnum[i]}. \( y = {functionq[i]} \) \hfill \newline "
    outputa += rf"\sageplot{{ plot({plotFunctions[i]},zorder=0) + plot({plotSA[i]},zorder=1) + point({plotPoints[i]},zorder=2)}} \hfill \newline "
\end{sagesilent}

% =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
% WORKSHEET INSTRUCTIONS
%=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=

\begin{center}
  Sketch the curve of the function on the interval \( -180 \degree  \le x \le 360 \degree \).
\end{center}
\vspace{0.5cm}

% =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
% GENERATE QUESTIONS
%=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
\sagestr{outputq}
\vspace{-1.5em}
\customfoot
\newpage
\answers
\sagestr{outputa}

\vspace{-1.5em}
\customfoot

\end{document}
